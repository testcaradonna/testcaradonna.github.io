$((function(){$.fn.imagesLoaded=function(e){var i=this.find("img"),t=i.length,r=this,n="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";function a(){e.call(r,i)}return t||a(),i.on("load error",(function e(){--t<=0&&this.src!==n&&(setTimeout(a),i.off("load error",e))})).each((function(){if(this.complete||void 0===this.complete){var e=this.src;this.src=n,this.src=e}})),this};var e,i,t,r,n,a,l,s,d=$("#rg-gallery"),c=d.find("div.es-carousel-wrapper"),o=c.find("ul > li"),f=o.length;Gallery=(e=0,i="carousel",t=!1,r=function(){c.show().elastislide({imageW:150,onClick:function(i){if(t)return!1;t=!0,s(i),e=i.index()}}),c.elastislide("setCurrent",e)},n=function(){var e=$('<a href="#" class="rg-view-full"></a>'),t=$('<a href="#" class="rg-view-thumbs rg-view-selected"></a>');d.prepend($('<div class="rg-view"/>').append(e).append(t)),e.on("click.rgGallery",(function(r){return"carousel"===i&&c.elastislide("destroy"),c.hide(),e.addClass("rg-view-selected"),t.removeClass("rg-view-selected"),i="fullview",!1})),t.on("click.rgGallery",(function(n){return r(),t.addClass("rg-view-selected"),e.removeClass("rg-view-selected"),i="carousel",!1})),"fullview"===i&&e.trigger("click")},a=function(){if($("#img-wrapper-tmpl").tmpl({itemsCount:f}).appendTo(d),f>1){var e=d.find("a.rg-image-nav-prev"),i=d.find("a.rg-image-nav-next"),t=d.find("div.rg-image");e.on("click.rgGallery",(function(e){return l("left"),!1})),i.on("click.rgGallery",(function(e){return l("right"),!1})),t.touchwipe({wipeLeft:function(){l("right")},wipeRight:function(){l("left")},preventDefaultEvents:!1}),$(document).on("keyup.rgGallery",(function(e){39==e.keyCode?l("right"):37==e.keyCode&&l("left")}))}},l=function(i){if(t)return!1;t=!0,"right"===i?e+1>=f?e=0:++e:"left"===i&&(e-1<0?e=f-1:--e),s(o.eq(e))},s=function(r){var n=d.find("div.rg-loading").show();o.removeClass("selected"),r.addClass("selected");var a=r.find("img"),l=a.data("large"),s=a.data("description");$("<img/>").load((function(){d.find("div.rg-image").empty().append('<img src="'+l+'"/>'),s&&d.find("div.rg-caption").show().children("p").empty().text(s),n.hide(),"carousel"===i&&(c.elastislide("reload"),c.elastislide("setCurrent",e)),t=!1})).attr("src",l)},{init:function(){o.add('<img src="images/ajax-loader.gif"/><img src="images/black.png"/>').imagesLoaded((function(){n(),a(),s(o.eq(e))})),"carousel"===i&&r()},addItems:function(e){c.find("ul").append(e),o=o.add($(e)),f=o.length,c.elastislide("add",e)}}),Gallery.init()}));